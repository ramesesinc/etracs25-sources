import com.rameses.annotations.*;

class CashReceiptPoliceClearancePersistenceInterceptor {

	@Service('EntityService') 
	def entitySvc; 

	@DataContext('cashreceipt_policeclearance_pending') 
	def receiptpendingdb;

	@After(pattern="PersistenceService.create", eval="#{args[0]._schemaname == 'policeclearance_application'}")
	public void afterCreateApp( evt ) {
		def arg = evt.args[0];
		def result = evt.result;  
		receiptpendingdb.find([ objid: result.payment?.objid ]).delete(); 
	}

	@After( pattern="PersistenceService.read", eval="#{args[0]._schemaname=='cashreceipt_policeclearance'}") 
	public void afterOpen( evt ) {
		def r = evt.result; 
		def ent = entitySvc.open([ objid: r.payer.objid ]); 
		if ( ent ) r.applicant = ent; 
	} 	
}

